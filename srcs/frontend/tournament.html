<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPA Example</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css">
</head>
<body>
    <div id="app">
		<!-- JavaScript -->
		<script>
			function showSection(sectionId) {
				document.querySelectorAll('.section').forEach(section => {
					section.style.display = 'none';
				});
				document.getElementById(sectionId).style.display = 'block';
			}
		</script>

		<!-- Barra de Navegação -->
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <a class="navbar-brand" href="#">Pong Game</a>
            <div class="navbar-nav">
                <a class="nav-item nav-link" href="#" onclick="showSection('login-section')">Login</a>
                <a class="nav-item nav-link" href="#" onclick="showSection('register-section')">Register</a>
                <a class="nav-item nav-link" href="#" onclick="showSection('dashboard-section')">Dashboard</a>
            </div>
        </nav>

        <!-- Seção de Registro -->
        <div id="register-section" class="container section" style="display: none;">
            <h2>Register</h2>
            <form id="register-form">
                <input type="text" id="username" name="username" placeholder="Username" required>
                <input type="email" id="email" name="email" placeholder="Email" required>
                <input type="password" id="password" name="password" placeholder="Password" required>
                <button type="submit">Register</button>
            </form>
            <div id="register-message"></div>
        </div>

		<!-- JavaScript -->
		<script>
		    document.getElementById('register-form').addEventListener('submit', function(event) {
		        event.preventDefault(); // Impede o comportamento padrão de enviar o formulário e recarregar a página

		        // Obtendo os dados do formulário
		        const username = document.getElementById('username').value;
		        const email = document.getElementById('email').value;
		        const password = document.getElementById('password').value;

		        // Criando o corpo da requisição
		        const requestData = {
		            username: username,
		            email: email,
		            password: password
		        };

		        // Fazendo a requisição para o backend usando fetch
		        fetch('/api/register/', {
		            method: 'POST',
		            headers: {
		                'Content-Type': 'application/json',
		            },
		            body: JSON.stringify(requestData)
		        })
		        .then(response => response.json())
		        .then(data => {
		            const messageDiv = document.getElementById('register-message');

		            if (data.message) {
		                // Caso de sucesso
		                messageDiv.innerHTML = `<p style="color: green;">${data.message}</p>`;
		            } else {
		                // Caso de erro - Mostra os erros na tela
		                let errors = Object.values(data).flat().join('<br>');
		                messageDiv.innerHTML = `<p style="color: red;">${errors}</p>`;
		            }
		        })
		        .catch(error => {
		            console.error('Error:', error);
		            document.getElementById('register-message').innerHTML = `<p style="color: red;">An error occurred. Please try again later.</p>`;
		        });
		    });
		</script>

        <!-- Seção de Login -->
        <div id="login-section" class="container section" style="display: none;">
            <h2>Login</h2>
            <form id="login-form">
                <input type="text" id="login-username" name="username" placeholder="Username" required>
                <input type="password" id="login-password" name="password" placeholder="Password" required>
                <button type="submit">Login</button>
            </form>
            <div id="login-message"></div>
        </div>

        <!-- Seção de Dashboard -->
        <div id="dashboard-section" class="container section" style="display: none;">
            <h2>Dashboard</h2>
            <div id="dashboard-content"></div>
        </div>

		<!-- JavaScript -->
		<script>
			function loadDashboard() {
				fetch('/api/dashboard/', {
					method: 'GET',
					headers: {
						'Authorization': 'Bearer ' + localStorage.getItem('token'),
						'Content-Type': 'application/json',
					}
				})
				.then(response => response.json())
				.then(data => {
					const dashboardContent = document.getElementById('dashboard-content');
					dashboardContent.innerHTML = `
						<p>Welcome, ${data.username}</p>
						<p>Friends: ${data.friends.length}</p>
						<p>Received Requests: ${data.received_requests.length}</p>
					`;
				})
				.catch(error => {
					console.error('Error:', error);
				});
			}
		</script>
    </div>
</body>
</html>
